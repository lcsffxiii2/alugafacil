FROM alpine:latest

# Instala ferramentas básicas
RUN apk add --no-cache ca-certificates

# Copia o executável PocketBase que você baixou
COPY pocketbase /usr/local/bin/pocketbase
RUN chmod +x /usr/local/bin/pocketbase

# Copia seu frontend (index.html) para a pasta pública do PocketBase
COPY index.html /pb_public/index.html

# Cria pasta para dados persistentes
RUN mkdir -p /pb_data

# Expõe a porta que o Railway usa
EXPOSE 8090

# Comando de inicialização
# --http=0.0.0.0:$PORT → usa a porta que o Railway define
# --dir=/pb_data → persistência (volume)
# --publicDir=/pb_public → serve seu index.html na raiz
CMD ["/usr/local/bin/pocketbase", "serve", "--http=0.0.0.0:${PORT}", "--dir=/pb_data", "--publicDir=/pb_public"]